import{J as H,K as V,L as S,d as ee,r as A,k as M,o as le,a6 as O,M as C,C as l,Z as te,g as se,y as m,B as t,N as B,V as N,O as y,z as n,a5 as _,D as g,P as r,W as $,A as i,T as v,X as z,Y as b,x as E,a4 as ne,a9 as R,al as ae,S as ie,af as I,ag as re,ap as W,a1 as oe,Q as de,R as ue,a7 as ce,ai as ye,aj as fe}from"./-SV6uRVe.js";import{u as ge}from"./Hqu9efcG.js";import{_ as me}from"./DlAUqK2U.js";const pe=H("gasCylinders",{state:()=>({cylinders:[],loading:!1,error:null,selectedCylinder:null}),getters:{availableCylinders:u=>u.cylinders.filter(s=>s.isAvailable),cylindersByBrand:u=>u.cylinders.reduce((d,c)=>{const f=c.brand||"Unknown";return d[f]||(d[f]=[]),d[f].push(c),d},{}),lowStockCylinders:u=>u.cylinders.filter(s=>s.stockQuantity<=5)},actions:{async fetchCylinders(){this.loading=!0,this.error=null;const u=V(),s=S();try{const d=await u.getAllGasCylinders(s.token||void 0);this.cylinders=d}catch(d){this.error=d.message||"Failed to fetch gas cylinders",this.cylinders=[]}finally{this.loading=!1}},async fetchCylinderById(u){this.loading=!0,this.error=null;const s=V(),d=S();try{const c=await s.getGasCylinderById(u,d.token||void 0);return this.selectedCylinder=c,c}catch(c){throw this.error=c.message||"Failed to fetch gas cylinder",this.selectedCylinder=null,c}finally{this.loading=!1}},async createCylinder(u){this.loading=!0,this.error=null;const s=V(),d=S();if(!d.token)throw this.error="Authentication token not found. Please login.",this.loading=!1,new Error(this.error);try{const c={...u,isAvailable:!0,supplier:{id:u.supplierId}},f=await s.createGasCylinder(c,d.token);return this.cylinders.push(f),f}catch(c){throw this.error=c.message||"Failed to create gas cylinder",c}finally{this.loading=!1}},async updateCylinder(u,s){var f;this.loading=!0,this.error=null;const d=V(),c=S();if(!c.token)throw this.error="Authentication token not found. Please login.",this.loading=!1,new Error(this.error);try{const h=await d.updateGasCylinder(u,s,c.token),k=this.cylinders.findIndex(x=>x.id===u);return k!==-1&&(this.cylinders[k]=h),((f=this.selectedCylinder)==null?void 0:f.id)===u&&(this.selectedCylinder=h),h}catch(h){throw this.error=h.message||"Failed to update gas cylinder",h}finally{this.loading=!1}},async deleteCylinder(u){var c;this.loading=!0,this.error=null;const s=V(),d=S();if(!d.token)throw this.error="Authentication token not found. Please login.",this.loading=!1,new Error(this.error);try{await s.deleteGasCylinder(u,d.token);const f=this.cylinders.findIndex(h=>h.id===u);return f!==-1&&this.cylinders.splice(f,1),((c=this.selectedCylinder)==null?void 0:c.id)===u&&(this.selectedCylinder=null),!0}catch(f){throw this.error=f.message||"Failed to delete gas cylinder",f}finally{this.loading=!1}},clearError(){this.error=null},clearSelectedCylinder(){this.selectedCylinder=null}}}),he={class:"d-flex justify-space-between align-center mb-4"},ve={key:0,style:{"font-size":"12px","max-height":"100px",overflow:"auto"}},Ce={key:1},_e={class:"text-h5 primary--text"},be={class:"text-h5 success--text"},ke={class:"text-h5 warning--text"},we={class:"text-h5 info--text"},xe={class:"font-weight-medium"},Se={class:"text-caption text-grey"},Ve={class:"d-flex gap-1"},Ae={class:"text-h5"},Be={class:"mt-2"},Ne=ee({__name:"gas-cylinders",setup(u){const s=pe(),d=ge(),c=S(),f=A(!1),h=[{title:"Image",key:"imageUrl",sortable:!1,width:"80px"},{title:"Name",key:"name"},{title:"Weight",key:"weight",width:"100px"},{title:"Price",key:"price",width:"120px"},{title:"Stock",key:"stockQuantity",width:"100px"},{title:"Available",key:"isAvailable",width:"120px"},{title:"Supplier",key:"supplier"},{title:"Actions",key:"actions",sortable:!1,width:"150px"}],k=A(""),x=A(""),U=A(""),D=A(!1),L=M(()=>{let o=s.cylinders||[];if(k.value){const e=k.value.toLowerCase();o=o.filter(w=>{var a,p,Q,T;return((a=w.name)==null?void 0:a.toLowerCase().includes(e))||((p=w.brand)==null?void 0:p.toLowerCase().includes(e))||((T=(Q=w.supplier)==null?void 0:Q.name)==null?void 0:T.toLowerCase().includes(e))})}if(x.value&&(o=o.filter(e=>e.brand===x.value)),U.value!==""){const e=U.value==="available";o=o.filter(w=>w.isAvailable===e)}return o}),X=M(()=>[...new Set(s.cylinders.map(e=>e.brand).filter(Boolean))].map(e=>({value:e,title:e}))),j=[{value:"available",title:"Available"},{value:"unavailable",title:"Unavailable"}],F=o=>(o||0).toLocaleString(),J=o=>o<=5?"error":o<=10?"warning":"success",q=()=>{console.log("Opening create dialog...")},P=o=>{s.selectedCylinder=o,console.log("Editing cylinder:",o.name)},K=o=>{s.selectedCylinder=o,D.value=!0},Y=o=>{confirm(`Are you sure you want to delete "${o.name}"?`)&&console.log("Deleting cylinder:",o.name)},G=async()=>{try{await Promise.all([s.fetchCylinders(),d.fetchSuppliers()])}catch(o){console.error("Error refreshing data:",o)}},Z=async()=>{console.log("Manual refresh triggered"),f.value=!0,await G()};return le(async()=>{console.log("Gas cylinders page mounted"),console.log("Auth token:",c.token?"Present":"Missing");try{await G(),console.log("Data loaded, cylinders count:",s.cylinders.length)}catch(o){console.error("Error loading data on mount:",o)}}),O(()=>d.suppliers.length,o=>{o===0&&!d.loading&&d.fetchSuppliers()}),O(()=>s.cylinders.length,o=>{console.log("Cylinders array length changed:",o)}),(o,e)=>{const w=se("v-simple-table");return m(),C(te,null,{default:l(()=>[t(N,null,{default:l(()=>[t(y,null,{default:l(()=>[n("div",he,[e[7]||(e[7]=n("div",null,[n("h1",{class:"text-h4"},"Gas Cylinders"),n("p",{class:"text-subtitle-1 text-grey"},"Manage your gas cylinder inventory")],-1)),t(_,{color:"primary",size:"large",onClick:q,"prepend-icon":"mdi-plus"},{default:l(()=>e[6]||(e[6]=[g(" Add Cylinder ")])),_:1,__:[6]})])]),_:1})]),_:1}),r(s).error?(m(),C($,{key:0,type:"error",dismissible:"",class:"mb-4","onClick:close":r(s).clearError},{default:l(()=>[g(i(r(s).error),1)]),_:1},8,["onClick:close"])):B("",!0),t(v,{class:"mb-4",color:"grey-lighten-5"},{default:l(()=>[t(z,null,{default:l(()=>e[8]||(e[8]=[g("🐛 Debug Info")])),_:1,__:[8]}),t(b,null,{default:l(()=>[t(N,null,{default:l(()=>[t(y,{cols:"12",md:"6"},{default:l(()=>[e[9]||(e[9]=n("strong",null,"Cylinders Store State:",-1)),n("ul",null,[n("li",null,"Loading: "+i(r(s).loading),1),n("li",null,"Error: "+i(r(s).error||"None"),1),n("li",null,"Cylinders Count: "+i(r(s).cylinders.length),1),n("li",null,"Filtered Count: "+i(L.value.length),1)])]),_:1,__:[9]}),t(y,{cols:"12",md:"6"},{default:l(()=>[e[10]||(e[10]=n("strong",null,"Sample Data:",-1)),r(s).cylinders.length>0?(m(),E("pre",ve,i(JSON.stringify(r(s).cylinders[0],null,2)),1)):(m(),E("span",Ce,"No cylinders loaded"))]),_:1,__:[10]})]),_:1}),t(_,{onClick:Z,color:"warning"},{default:l(()=>e[11]||(e[11]=[g("Manual Debug Refresh")])),_:1,__:[11]})]),_:1})]),_:1}),t(N,{class:"mb-6"},{default:l(()=>[t(y,{cols:"12",sm:"6",md:"3"},{default:l(()=>[t(v,{class:"text-center"},{default:l(()=>[t(b,null,{default:l(()=>[n("div",_e,i(r(s).cylinders.length),1),e[12]||(e[12]=n("div",{class:"text-subtitle-1"},"Total Cylinders",-1))]),_:1,__:[12]})]),_:1})]),_:1}),t(y,{cols:"12",sm:"6",md:"3"},{default:l(()=>[t(v,{class:"text-center"},{default:l(()=>[t(b,null,{default:l(()=>[n("div",be,i(r(s).availableCylinders.length),1),e[13]||(e[13]=n("div",{class:"text-subtitle-1"},"Available",-1))]),_:1,__:[13]})]),_:1})]),_:1}),t(y,{cols:"12",sm:"6",md:"3"},{default:l(()=>[t(v,{class:"text-center"},{default:l(()=>[t(b,null,{default:l(()=>[n("div",ke,i(r(s).lowStockCylinders.length),1),e[14]||(e[14]=n("div",{class:"text-subtitle-1"},"Low Stock",-1))]),_:1,__:[14]})]),_:1})]),_:1}),t(y,{cols:"12",sm:"6",md:"3"},{default:l(()=>[t(v,{class:"text-center"},{default:l(()=>[t(b,null,{default:l(()=>[n("div",we,i(Object.keys(r(s).cylindersByBrand).length),1),e[15]||(e[15]=n("div",{class:"text-subtitle-1"},"Brands",-1))]),_:1,__:[15]})]),_:1})]),_:1})]),_:1}),t(v,{class:"mb-4"},{default:l(()=>[t(b,null,{default:l(()=>[t(N,null,{default:l(()=>[t(y,{cols:"12",md:"4"},{default:l(()=>[t(ne,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=a=>k.value=a),label:"Search cylinders...","prepend-inner-icon":"mdi-magnify",clearable:"",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),t(y,{cols:"12",md:"3"},{default:l(()=>[t(R,{modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=a=>x.value=a),items:X.value,label:"Filter by Brand",clearable:"",dense:"",outlined:""},null,8,["modelValue","items"])]),_:1}),t(y,{cols:"12",md:"3"},{default:l(()=>[t(R,{modelValue:U.value,"onUpdate:modelValue":e[2]||(e[2]=a=>U.value=a),items:j,label:"Availability",clearable:"",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),t(y,{cols:"12",md:"2"},{default:l(()=>[t(_,{color:"primary",block:"",onClick:G,loading:r(s).loading},{default:l(()=>e[16]||(e[16]=[g(" Refresh ")])),_:1,__:[16]},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(v,null,{default:l(()=>[t(ae,{headers:h,items:L.value,loading:r(s).loading,"item-value":"id",class:"elevation-1","items-per-page":10,"no-data-text":r(s).loading?"Loading cylinders...":"No gas cylinders found"},{"item.imageUrl":l(({item:a})=>[t(re,{size:"40",class:"my-2"},{default:l(()=>[a.imageUrl?(m(),C(W,{key:0,src:a.imageUrl,alt:a.name},null,8,["src","alt"])):(m(),C(oe,{key:1},{default:l(()=>e[17]||(e[17]=[g("mdi-gas-cylinder")])),_:1,__:[17]}))]),_:2},1024)]),"item.name":l(({item:a})=>[n("div",null,[n("div",xe,i(a.name||"Unknown"),1),n("div",Se,i(a.brand||"No brand"),1)])]),"item.weight":l(({item:a})=>[n("span",null,i(a.weight||0)+" kg",1)]),"item.price":l(({item:a})=>[n("span",null,"UGX "+i(F(a.price)),1)]),"item.stockQuantity":l(({item:a})=>[t(I,{color:J(a.stockQuantity),size:"small",class:"ma-1"},{default:l(()=>[g(i(a.stockQuantity||0),1)]),_:2},1032,["color"])]),"item.isAvailable":l(({item:a})=>[t(I,{color:a.isAvailable?"success":"error",size:"small",class:"ma-1"},{default:l(()=>[g(i(a.isAvailable?"Available":"Unavailable"),1)]),_:2},1032,["color"])]),"item.supplier":l(({item:a})=>{var p;return[n("span",null,i(((p=a.supplier)==null?void 0:p.name)||"No supplier"),1)]}),"item.actions":l(({item:a})=>[n("div",Ve,[t(_,{icon:"mdi-eye",size:"small",variant:"text",onClick:p=>K(a)},null,8,["onClick"]),t(_,{icon:"mdi-pencil",size:"small",variant:"text",onClick:p=>P(a)},null,8,["onClick"]),t(_,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:p=>Y(a)},null,8,["onClick"])])]),loading:l(()=>[t(ie,{type:"table-tbody"})]),"no-data":l(()=>[t($,{type:"info",class:"ma-4"},{default:l(()=>[g(i(r(s).loading?"Loading gas cylinders...":'No gas cylinders found. Click "Add Cylinder" to get started.'),1)]),_:1})]),_:1},8,["items","loading","no-data-text"])]),_:1}),L.value.length>0&&f.value?(m(),C(v,{key:1,class:"mt-4"},{default:l(()=>[t(z,null,{default:l(()=>e[18]||(e[18]=[g("Fallback Table View")])),_:1,__:[18]}),t(b,null,{default:l(()=>[t(w,null,{default:l(()=>[e[19]||(e[19]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"Brand"),n("th",null,"Weight"),n("th",null,"Price"),n("th",null,"Stock"),n("th",null,"Supplier")])],-1)),n("tbody",null,[(m(!0),E(de,null,ue(L.value.slice(0,5),a=>{var p;return m(),E("tr",{key:a.id},[n("td",null,i(a.name),1),n("td",null,i(a.brand||"N/A"),1),n("td",null,i(a.weight)+" kg",1),n("td",null,"UGX "+i(F(a.price)),1),n("td",null,i(a.stockQuantity),1),n("td",null,i(((p=a.supplier)==null?void 0:p.name)||"N/A"),1)])}),128))])]),_:1})]),_:1})]),_:1})):B("",!0),t(ce,{modelValue:D.value,"onUpdate:modelValue":e[5]||(e[5]=a=>D.value=a),"max-width":"500px"},{default:l(()=>[r(s).selectedCylinder?(m(),C(v,{key:0},{default:l(()=>[t(z,null,{default:l(()=>[n("span",Ae,i(r(s).selectedCylinder.name),1)]),_:1}),t(b,null,{default:l(()=>[t(N,null,{default:l(()=>[r(s).selectedCylinder.imageUrl?(m(),C(y,{key:0,cols:"12"},{default:l(()=>[t(W,{src:r(s).selectedCylinder.imageUrl,alt:r(s).selectedCylinder.name,"max-height":"200",contain:""},null,8,["src","alt"])]),_:1})):B("",!0),t(y,{cols:"6"},{default:l(()=>[e[20]||(e[20]=n("strong",null,"Brand:",-1)),g(" "+i(r(s).selectedCylinder.brand||"N/A"),1)]),_:1,__:[20]}),t(y,{cols:"6"},{default:l(()=>[e[21]||(e[21]=n("strong",null,"Weight:",-1)),g(" "+i(r(s).selectedCylinder.weight)+" kg ",1)]),_:1,__:[21]}),t(y,{cols:"6"},{default:l(()=>[e[22]||(e[22]=n("strong",null,"Price:",-1)),g(" UGX "+i(F(r(s).selectedCylinder.price)),1)]),_:1,__:[22]}),t(y,{cols:"6"},{default:l(()=>[e[23]||(e[23]=n("strong",null,"Stock:",-1)),g(" "+i(r(s).selectedCylinder.stockQuantity),1)]),_:1,__:[23]}),t(y,{cols:"6"},{default:l(()=>{var a;return[e[24]||(e[24]=n("strong",null,"Supplier:",-1)),g(" "+i(((a=r(s).selectedCylinder.supplier)==null?void 0:a.name)||"N/A"),1)]}),_:1,__:[24]}),t(y,{cols:"6"},{default:l(()=>[e[25]||(e[25]=n("strong",null,"Status:",-1)),t(I,{color:r(s).selectedCylinder.isAvailable?"success":"error",size:"small"},{default:l(()=>[g(i(r(s).selectedCylinder.isAvailable?"Available":"Unavailable"),1)]),_:1},8,["color"])]),_:1,__:[25]}),r(s).selectedCylinder.description?(m(),C(y,{key:1,cols:"12"},{default:l(()=>[e[26]||(e[26]=n("strong",null,"Description:",-1)),n("p",Be,i(r(s).selectedCylinder.description),1)]),_:1,__:[26]})):B("",!0)]),_:1})]),_:1}),t(ye,null,{default:l(()=>[t(fe),t(_,{text:"",onClick:e[3]||(e[3]=a=>D.value=!1)},{default:l(()=>e[27]||(e[27]=[g("Close")])),_:1,__:[27]}),t(_,{color:"primary",onClick:e[4]||(e[4]=a=>P(r(s).selectedCylinder))},{default:l(()=>e[28]||(e[28]=[g(" Edit ")])),_:1,__:[28]})]),_:1})]),_:1})):B("",!0)]),_:1},8,["modelValue"])]),_:1})}}}),Ee=me(Ne,[["__scopeId","data-v-bf6f7801"]]);export{Ee as default};
